{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///project/sandbox/user-workspace/src/app/%28dashboard%29/reportes/page.tsx"],"sourcesContent":["\"use client\"\n\nimport { useState, useEffect } from 'react'\nimport { Reporte } from '@/types'\n\nexport default function ReportesPage() {\n  const [reporte, setReporte] = useState<Reporte>({ consumos: [], totales: [] })\n  const [proyectos, setProyectos] = useState([])\n  const [filtros, setFiltros] = useState({\n    proyectoId: '',\n    fechaInicio: '',\n    fechaFin: ''\n  })\n  const [isGenerating, setIsGenerating] = useState(false)\n\n  useEffect(() => {\n    loadProyectos()\n  }, [])\n\n  const loadProyectos = async () => {\n    try {\n      const response = await fetch('/api/proyectos')\n      const data = await response.json()\n      setProyectos(data)\n    } catch (error) {\n      console.error('Error loading proyectos:', error)\n    }\n  }\n\n  const loadReporte = async () => {\n    try {\n      const params = new URLSearchParams()\n      if (filtros.proyectoId) params.append('proyectoId', filtros.proyectoId)\n      if (filtros.fechaInicio) params.append('fechaInicio', filtros.fechaInicio)\n      if (filtros.fechaFin) params.append('fechaFin', filtros.fechaFin)\n\n      const response = await fetch(`/api/reportes?${params}`)\n      const data = await response.json()\n      setReporte(data)\n    } catch (error) {\n      console.error('Error loading reporte:', error)\n    }\n  }\n\n  const generateExcel = async () => {\n    setIsGenerating(true)\n    try {\n      const params = new URLSearchParams()\n      if (filtros.proyectoId) params.append('proyectoId', filtros.proyectoId)\n      if (filtros.fechaInicio) params.append('fechaInicio', filtros.fechaInicio)\n      if (filtros.fechaFin) params.append('fechaFin', filtros.fechaFin)\n\n      const response = await fetch(`/api/reportes/excel?${params}`)\n      const data = await response.json()\n      \n      if (data.success) {\n        // Decodificar base64 y descargar\n        const binaryString = atob(data.data)\n        const bytes = new Uint8Array(binaryString.length)\n        for (let i = 0; i < binaryString.length; i++) {\n          bytes[i] = binaryString.charCodeAt(i)\n        }\n        \n        const blob = new Blob([bytes], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' })\n        const url = window.URL.createObjectURL(blob)\n        const a = document.createElement('a')\n        a.href = url\n        a.download = data.filename\n        document.body.appendChild(a)\n        a.click()\n        window.URL.revokeObjectURL(url)\n        document.body.removeChild(a)\n      }\n    } catch (error) {\n      console.error('Error generating Excel:', error)\n    } finally {\n      setIsGenerating(false)\n    }\n  }\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault()\n    loadReporte()\n  }\n\n  return (\n    <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n      <div className=\"bg-white shadow-xl rounded-lg overflow-hidden\">\n        <div className=\"bg-slate-800 px-6 py-4\">\n          <h1 className=\"text-2xl font-bold text-white\">Reportes de Consumo</h1>\n        </div>\n        \n        <div className=\"p-6\">\n          <form onSubmit={handleSubmit} className=\"mb-6 space-y-4\">\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-slate-700 mb-1\">Proyecto</label>\n                <select\n                  value={filtros.proyectoId}\n                  onChange={(e) => setFiltros({...filtros, proyectoId: e.target.value})}\n                  className=\"w-full border border-slate-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-slate-500\"\n                >\n                  <option value=\"\">Todos los proyectos</option>\n                  {proyectos.map((p: any) => (\n                    <option key={p.id} value={p.id}>{p.nombreProyecto}</option>\n                  ))}\n                </select>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-slate-700 mb-1\">Fecha Inicio</label>\n                <input\n                  type=\"date\"\n                  value={filtros.fechaInicio}\n                  onChange={(e) => setFiltros({...filtros, fechaInicio: e.target.value})}\n                  className=\"w-full border border-slate-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-slate-500\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-slate-700 mb-1\">Fecha Fin</label>\n                <input\n                  type=\"date\"\n                  value={filtros.fechaFin}\n                  onChange={(e) => setFiltros({...filtros, fechaFin: e.target.value})}\n                  className=\"w-full border border-slate-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-slate-500\"\n                />\n              </div>\n              <div className=\"flex items-end space-x-2\">\n                <button type=\"submit\" className=\"bg-slate-800 text-white px-4 py-2 rounded-md hover:bg-slate-700 transition-colors\">\n                  Generar Reporte\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={generateExcel}\n                  disabled={isGenerating}\n                  className=\"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors disabled:opacity-50\"\n                >\n                  {isGenerating ? 'Generando...' : 'Descargar Excel'}\n                </button>\n              </div>\n            </div>\n          </form>\n\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <div>\n              <h2 className=\"text-xl font-semibold mb-4 text-slate-800\">Consumos Detallados</h2>\n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full divide-y divide-slate-200\">\n                  <thead className=\"bg-slate-50\">\n                    <tr>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Fecha</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Trabajador</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Proyecto</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">EPP</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Cantidad</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white divide-y divide-slate-200\">\n                    {reporte.consumos.map((consumo: any) => (\n                      <tr key={consumo.id} className=\"hover:bg-slate-50\">\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-slate-600\">{new Date(consumo.fecha).toLocaleDateString()}</td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-slate-600\">{consumo.trabajador?.nombre}</td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-slate-600\">{consumo.proyecto?.nombreProyecto}</td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-slate-600\">{consumo.epp?.descripcion}</td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-slate-600\">{consumo.cantidadConsumida}</td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            </div>\n\n            <div>\n              <h2 className=\"text-xl font-semibold mb-4 text-slate-800\">Totales por EPP</h2>\n              <div className=\"space-y-2\">\n                {reporte.totales.map((total: any) => (\n                  <div key={total.id} className=\"flex justify-between items-center p-3 bg-slate-50 rounded-md\">\n                    <span className=\"text-sm font-medium text-slate-700\">{total.descripcion}</span>\n                    <span className=\"text-sm font-semibold text-slate-900\">{total.cantidadTotal} unidades</span>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}